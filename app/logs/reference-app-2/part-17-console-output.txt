10:21:43 am: Executing 'run --args="reference-app-2" --stacktrace'...

> Task :app:checkKotlinGradlePluginConfigurationErrors SKIPPED
> Task :spark:checkKotlinGradlePluginConfigurationErrors SKIPPED
> Task :tables:checkKotlinGradlePluginConfigurationErrors SKIPPED
> Task :tables:compileKotlin UP-TO-DATE
> Task :tables:compileJava NO-SOURCE
> Task :tables:processResources NO-SOURCE
> Task :tables:classes UP-TO-DATE
> Task :tables:jar UP-TO-DATE
> Task :spark:compileKotlin UP-TO-DATE
> Task :spark:compileJava NO-SOURCE
> Task :spark:processResources NO-SOURCE
> Task :spark:classes UP-TO-DATE
> Task :spark:jar UP-TO-DATE
> Task :app:compileKotlin UP-TO-DATE
> Task :app:compileJava NO-SOURCE
> Task :app:processResources UP-TO-DATE
> Task :app:classes UP-TO-DATE

> Task :app:run
Starting...
10:21:44.825 [main] WARN  org.apache.spark.util.Utils MDC= - Your hostname, Pauls-MacBook-Air.local resolves to a loopback address: 127.0.0.1; using 10.27.20.64 instead (on interface en0)
10:21:44.826 [main] WARN  org.apache.spark.util.Utils MDC= - Set SPARK_LOCAL_IP if you need to bind to another address
10:21:44.954 [main] WARN  o.a.hadoop.util.NativeCodeLoader MDC= - Unable to load native-hadoop library for your platform... using builtin-java classes where applicable
10:21:45.536 [main] INFO  c.e.d.spark.TableProcessor MDC= - raw customers
SLF4J: Class path contains multiple SLF4J providers.
SLF4J: Found provider [ch.qos.logback.classic.spi.LogbackServiceProvider@396f6598]
SLF4J: Found provider [org.apache.logging.slf4j.SLF4JServiceProvider@394e1a0f]
SLF4J: See https://www.slf4j.org/codes.html#multiple_bindings for an explanation.
SLF4J: Actual provider is of type [ch.qos.logback.classic.spi.LogbackServiceProvider@396f6598]
+----------+--------------------+-----------+
|company_id|             address|total_spend|
+----------+--------------------+-----------+
|         1|APARTMENT 2,\n52 ...|       5700|
|         2|107 SHERINGHAM AV...|       4700|
|         3|43 SUNNINGDALE,\n...|       5900|
|         4|HAWESWATER HOUSE,...|       7200|
|         5|AMBERFIELD BARN H...|       4600|
|         6|FIRST FLOOR CEF B...|       4600|
|         7|37 BEVERLEY ROAD,...|       7300|
|         8|B82 ALBION RIVERS...|       6100|
|         9|Flat 27, Domelton...|       4200|
|        10|34 BROOKSIDE ESTA...|       5800|
+----------+--------------------+-----------+
only showing top 10 rows

10:21:47.695 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.EmptyCount
10:21:48.165 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.RowCount
10:21:48.202 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.ColCount
10:21:48.202 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.DuplicateCount
10:21:48.690 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.Summary
+-------+------------------+
|summary|       total_spend|
+-------+------------------+
|  count|            100000|
|   mean|          4951.662|
| stddev|1500.9838664295094|
|    min|                 0|
|    max|              9900|
|    25%|            3900.0|
|    50%|            5000.0|
|    75%|            6000.0|
+-------+------------------+

10:21:49.192 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.CountByValue
10:21:49.192 [main] WARN  c.e.d.spark.statistics.CountByValue MDC= - Column city not found in dataset.
10:21:49.309 [main] INFO  c.e.d.spark.TableProcessor MDC= - valid customers
+----------+--------------------+-----------+
|company_id|             address|total_spend|
+----------+--------------------+-----------+
|        69|LEO UNIT LANDOR R...|    5500.00|
|       139|110 REGENT RD.,\n...|    6200.00|
|       472|20C UNDERHILL ROA...|    1500.00|
|       859|Tall Trees Beehiv...|    4100.00|
|      1360|82 JAMES STREET,\...|    5200.00|
|      1718|42 PEGASUS GARDEN...|    5200.00|
|      1760|20-22 WENLOCK ROA...|    6900.00|
|      2059|105 DAMSELFLY ROA...|    5300.00|
|      2094|40 TRAILCOCK ROAD...|    3200.00|
|      2246|THORP ARCH GRANGE...|    5100.00|
+----------+--------------------+-----------+
only showing top 10 rows

10:21:49.719 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.EmptyCount
10:21:50.976 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.RowCount
10:21:51.236 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.ColCount
10:21:51.236 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.DuplicateCount
10:21:51.620 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.Summary
+-------+------------------+
|summary|       total_spend|
+-------+------------------+
|  count|             99032|
|   mean|       4951.673197|
| stddev|1500.6423977802363|
|    min|              0.00|
|    max|          11700.00|
|    25%|            3900.0|
|    50%|            5000.0|
|    75%|            6000.0|
+-------+------------------+

10:21:52.420 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.CountByValue
10:21:52.420 [main] WARN  c.e.d.spark.statistics.CountByValue MDC= - Column city not found in dataset.
10:21:52.489 [main] INFO  c.e.d.spark.TableProcessor MDC= - customers took 00:00:06.954
10:21:52.489 [main] INFO  c.e.d.spark.TableProcessor MDC= - raw cities
+---------------+
|            _c0|
+---------------+
|        England|
|           Bath|
|    Birmingham*|
|      Bradford*|
|Brighton & Hove|
|       Bristol*|
|      Cambridge|
|    Canterbury*|
|       Carlisle|
|     Chelmsford|
+---------------+
only showing top 10 rows

10:21:52.566 [main] INFO  c.e.d.spark.TableProcessor MDC= - valid cities
+---------------+
|           city|
+---------------+
|      Worcester|
|       Cardiff*|
|      Lichfield|
|      Inverness|
|        Exeter*|
|     Sunderland|
|        Lisburn|
|Stoke on Trent*|
|      Cambridge|
|       Bristol*|
+---------------+
only showing top 10 rows

10:21:52.649 [main] INFO  c.e.d.spark.TableProcessor MDC= - cities took 00:00:00.160
10:21:52.650 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting pipeline id=part17 name=Part 17 Pipeline 1
10:21:52.651 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor ValuesProcessor(id='city.1', name='Value filter', description='Remove rows where values match those specified', table='cities', column='city', values=[England, Scotland, Wales, Northern Ireland])
10:21:52.656 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor ValuesProcessor(id='city.1', name='Value filter', description='Remove rows where values match those specified', table='cities', column='city', values=[England, Scotland, Wales, Northern Ireland])
10:21:52.657 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor RegExReplaceProcessor(id='city.2', name='Reg ex replace filter', description='Remove * from city names', table='cities', column='city', regex='[*#@]', replacement='')
10:21:52.659 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor RegExReplaceProcessor(id='city.2', name='Reg ex replace filter', description='Remove * from city names', table='cities', column='city', regex='[*#@]', replacement='')
10:21:52.659 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor com.example.dataprocessingexperiment.app.part17.ValueContainsOneInListProcessor@3b0e8bc4
10:21:52.762 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor com.example.dataprocessingexperiment.app.part17.ValueContainsOneInListProcessor@3b0e8bc4
10:21:52.762 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor com.example.dataprocessingexperiment.app.part17.CityProcessor@d5eed70
10:21:52.765 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor com.example.dataprocessingexperiment.app.part17.CityProcessor@d5eed70
10:21:52.766 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor OutputProcessor(id='customers.city.output', name='Output customers with city', description='Writes out the enriched customers', table='customers', path='./build/output/reference-app-2/transformed/city', format='csv', mode='overwrite', options={header=true})
10:21:53.727 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor OutputProcessor(id='customers.city.output', name='Output customers with city', description='Writes out the enriched customers', table='customers', path='./build/output/reference-app-2/transformed/city', format='csv', mode='overwrite', options={header=true})
10:21:53.728 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor AggregateSumProcessor(id='customers.4', name='City total', description='Sum by city', table='customers', sumColumn='total_spend', groupColumn='city', resultTable='city_totals')
10:21:53.731 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor AggregateSumProcessor(id='customers.4', name='City total', description='Sum by city', table='customers', sumColumn='total_spend', groupColumn='city', resultTable='city_totals')
10:21:53.731 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Starting processor OutputProcessor(id='customers.output', name='Output transformed customers', description='Writes out the enriched customers', table='city_totals', path='./build/output/reference-app-2/transformed/city_totals', format='csv', mode='overwrite', options={header=true})
10:21:54.503 [main] INFO  c.e.d.s.pipeline.PipelineProcessor MDC= - Finished processor OutputProcessor(id='customers.output', name='Output transformed customers', description='Writes out the enriched customers', table='city_totals', path='./build/output/reference-app-2/transformed/city_totals', format='csv', mode='overwrite', options={header=true})
==============================================
Context
customers ordered by company_id
+----------+--------------------+-----------+----------+
|company_id|             address|total_spend|      city|
+----------+--------------------+-----------+----------+
|         1|APARTMENT 2,\n52 ...|    5700.00|    LONDON|
|        10|34 BROOKSIDE ESTA...|    5800.00|    OXFORD|
|       100|PROFILE WEST SUIT...|    4600.00|     OTHER|
|      1000|35 SOUTH STREET,\...|    5800.00|     OTHER|
|     10000|18 BROUGHTON ROAD...|    5900.00|     OTHER|
|    100000|Manningham Mills ...|    5100.00|  BRADFORD|
|     10001|WILMSLOW ROAD,\nW...|    3900.00|     OTHER|
|     10002|71-75 SHELTON STR...|    4500.00|    LONDON|
|     10003|24 HAYNES AVENUE,...|    4100.00|NOTTINGHAM|
|     10004|19 ESTCOURT ROAD,...|    5100.00| SALISBURY|
+----------+--------------------+-----------+----------+
only showing top 10 rows

cities ordered by city
+---------------+
|           city|
+---------------+
|       Aberdeen|
|         Armagh|
|         Bangor|
|           Bath|
|        Belfast|
|     Birmingham|
|       Bradford|
|Brighton & Hove|
|        Bristol|
|      Cambridge|
+---------------+
only showing top 10 rows

city_totals ordered by city
+---------------+-----------+
|           city|total_spend|
+---------------+-----------+
|       ABERDEEN| 1322700.00|
|         ARMAGH|  263400.00|
|         BANGOR|  292000.00|
|           BATH| 1010400.00|
|        BELFAST| 2059400.00|
|     BIRMINGHAM| 9317900.00|
|       BRADFORD| 2060700.00|
|BRIGHTON & HOVE|    7400.00|
|        BRISTOL| 5730400.00|
|      CAMBRIDGE| 1999200.00|
+---------------+-----------+
only showing top 10 rows

==============================================
10:21:55.816 [main] INFO  c.e.d.app.ReferenceApp2 MDC= - transformed stats customers
10:21:55.817 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.EmptyCount
10:21:56.857 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.RowCount
10:21:57.082 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.ColCount
10:21:57.082 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.DuplicateCount
10:21:57.794 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.Summary
+-------+------------------+
|summary|       total_spend|
+-------+------------------+
|  count|             99032|
|   mean|       4951.673197|
| stddev|1500.6423977802363|
|    min|              0.00|
|    max|          11700.00|
|    25%|            3900.0|
|    50%|            5000.0|
|    75%|            6000.0|
+-------+------------------+

10:21:58.383 [main] INFO  c.e.d.s.statistics.StatisticsRunner MDC= - Running statistic: com.example.dataprocessingexperiment.spark.statistics.CountByValue
10:21:59.102 [main] INFO  c.e.d.app.ReferenceApp2 MDC= - transformed stats cities
10:21:59.102 [main] INFO  c.e.d.app.ReferenceApp2 MDC= - transformed stats city_totals
10:21:59.128 [main] INFO  c.e.d.app.ReferenceApp2 MDC= - Took 00:00:13.595
Finished...

BUILD SUCCESSFUL in 15s
7 actionable tasks: 1 executed, 6 up-to-date
10:21:59 am: Execution finished 'run --args="reference-app-2" --stacktrace'.
